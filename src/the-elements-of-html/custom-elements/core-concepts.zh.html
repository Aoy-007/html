  <h4 id="custom-elements-core-concepts">核心概念</h4>

  <p><dfn export>custom element</dfn> 是 <span data-x="concept-element-custom">自定义的</span> 元素。
  非形式化地，这意味着它的构造器和原型链由作者而不是用户代理定义。
  作者提供的构造函数称为 <dfn export data-x="custom element constructor">custom element 构造器</dfn>。</p>

  <p>可以定义两种不同的 <span data-x="custom element">custom elements</span>：</p>

  <ol>
   <li><p><dfn export data-x="autonomous custom element">自主的 custom element</dfn> 定义时不包含 <code
   data-x="">extends</code> 选项。这类 custom elements 的 局部名 等于它们
   <span data-x="concept-custom-element-definition-name">定义的名称</span>。</p></li>

   <li><p><dfn export data-x="customized built-in element">定制内建元素</dfn> 定义时包含 <code
   data-x="">extends</code> 选项。这类 custom elements 的 局部名 等于它们
   在 <code data-x="">extends</code> 选项中传入的值，它们的 <span
   data-x="concept-custom-element-definition-name">定义的名称</span> 被用于
   <dfn element-attr for="html-global"><code data-x="attr-is">is</code></dfn> 属性的值，因此它必须是一个
   <span data-x="valid custom element name">合法的 custom element 名</span>。</p></li>

  </ol>

  <p>在 <span>custom element</span> 被 <span data-x="create an element">创建</span> 后，
  更改 <code data-x="attr-is">is</code> 属性的值不会更改该元素的行为，因为它只是
  保存为该元素的 <span data-x="concept-element-is-value"><code data-x="">is</code> 的值</span>。</p>

  <p><span data-x="autonomous custom element">自主的 custom elements</span> 有下列的元素定义：</p>

  <dl class="element">
   <dt><span data-x="concept-element-categories">类别</span>：</dt>
   <dd><span data-x="flow content">流式内容</span>。</dd>
   <dd><span data-x="phrasing content">短语内容</span>。</dd>
   <dd><span data-x="palpable content">可感知内容</span>。</dd>
   <dd><span data-x="form-associated custom element">表单相关的 custom element</span>：<span data-x="category-listed">在列表中的</span>, <span data-x="category-label">可加标签的</span>, <span data-x="category-submit">可提交的</span> 和 <span data-x="category-reset">可重置的</span> <span data-x="form-associated element">表单相关元素</span>。</dd>
   <dt><span data-x="concept-element-contexts">该元素可使用的上下文</span>：</dt>
   <dd>应该出现 <span data-x="phrasing content">短语内容</span> 的地方。</dd>
   <dt><span data-x="concept-element-content-model">内容模型</span>：</dt>
   <dd><span data-x="transparent">透明的</span>。</dd>
   <dt><span data-x="concept-element-attributes">内容属性</span>：</dt>
   <dd>除 <code data-x="attr-is">is</code> 之外的 <span data-x="Global attributes">全局属性</span><!-- no-annotate --></dd>
   <dd><span data-x="form-associated custom element">表单相关元素</span> 的 <code data-x="attr-fae-form">form</code></dd>
   <dd><span data-x="form-associated custom element">表单相关元素</span> 的 <code data-x="attr-fe-disabled">disabled</code></dd>
   <dd><span data-x="form-associated custom element">表单相关元素</span> 的 <code data-x="attr-face-readonly">readonly</code></dd>
   <dd><span data-x="form-associated custom element">表单相关元素</span> 的 <code data-x="attr-fe-name">name</code></dd>
   <dd>任何其他没有命名空间的属性。</dd>
   <dt><span
   data-x="concept-element-accessibility-considerations">可访问性相关</span>：</dt>
   <dd><span data-x="form-associated custom element">表单相关的 custom element</span>：<a
   href="https://w3c.github.io/html-aria/#el-form-associated-custom-element">使用方版本</a>；<a
   href="https://w3c.github.io/html-aam/#el-form-associated-custom-element">实现方版本</a>。</dd>
   <dd>其他的：<a
   href="https://w3c.github.io/html-aria/#el-autonomous-custom-element">使用方版本</a>；<a
   href="https://w3c.github.io/html-aam/#el-autonomous-custom-element">实现方版本</a>。</dd>
   <dt><span data-x="concept-element-dom">DOM 接口</span>：</dt>
   <dd>由元素作者提供（继承自 <code>HTMLElement</code>）</dd>
  </dl>


  <p><span data-x="autonomous custom element">自主的 custom element</span> 没有任何特殊含义：它
  <span data-x="represents">表示</span> 它的子节点。 <span data-x="customized built-in element">定制内建元素</span> 继承了它扩展的元素的语义。</p>

  <p>任何没有命名空间的并与元素功能相关的属性，都可以按照元素作者的决定添加到
  <span data-x="autonomous custom element">自主的 custom element</span> 上，
  只要该属性名是 <span data-x="XML-compatible">XML 兼容的</span> 其不含 <span data-x="ASCII upper
  alpha">ASCII 大写字母</span>。<code data-x="attr-is">is</code> 属性较为特殊，
  它不能声明在 <span data-x="autonomous custom element">自主的 custom element</span> 上（如果设置的话不会有任何效果）。</p>

  <p><span data-x="customized built-in element">定制内建元素</span> 遵循普通的属性名要求
  （基于它们扩展的元素）。新增自定义的基于属性的行为，可使用
  <code data-x="attr-data-*">data-*</code> 属性。</p>

  <hr>

  <p>一个 <span data-x="autonomous custom element">自主的 custom element</span>，如果与一个
  <span data-x="concept-custom-element-definition-form-associated">form-associated</span> 字段为 true
  的 <span data-x="custom element definition">Custom Element 定义</span> 相关联，
  就称为 <dfn export data-x="form-associated custom element">表单相关的 custom element</dfn>。</p>

  <p><code data-x="attr-fe-name">name</code> 属性表示 <span data-x="form-associated custom element">表单相关的 custom element</span> 的名字。
  <code data-x="attr-fe-disabled">disabled</code> 属性用来让 <span data-x="form-associated custom element">表单相关的 custom element</span>
  不可交互并阻止它的 <span data-x="face-submission-value">提交数据</span> 被提交。
  <code data-x="attr-fae-form">form</code> 属性用来明确地把
  <span data-x="form-associated custom element">表单相关的 custom element</span> 和它的 <span data-x="form owner">表单 owner</span> 相关联。</p>

  <p><dfn data-x="attr-face-readonly"><code>readonly</code></dfn> 属性指定该元素
  <span data-x="barred from constraint validation">禁止约束验证</span>。用户代理不会给这个属性提供任何其他行为，
  但 custom element 作者应该利用它是否存在来以某种方式让控件变得不可编辑，类似内置控件的
  <span data-x="attr-input-readonly">readonly</span> 属性那样。</p>

  <p><strong>强校验</strong>：如果 <span data-x="form-associated custom element">表单相关的 custom element</span> 的指定了
  <code data-x="attr-face-readonly">readonly</code> 属性，该元素就 <span data-x="barred from constraint validation">禁止了约束验证</span>。</p>

  <p><span data-x="form-associated custom element">表单相关的 custom element</span> 的 <span data-x="concept-form-reset-control">重置算法</span>
  是用这个元素 <span data-x="enqueue a custom element callback reaction">入队一个 Custom Element 反应</span>，回调名为 "<code
  data-x="">formResetCallback</code>"，参数列表为空。</p>

  <hr>

  <p><dfn export data-x="valid custom element name">合法的 custom element 名</dfn> 是满足以下要求的一串字符 <var>name</var>：</p>

  <ul>
   <li>
    <p><var>name</var> 必须匹配 <code
    data-x="prod-PotentialCustomElementName">PotentialCustomElementName</code> 生成式：</p>

    <dl>
     <dt><code data-x=""><dfn
     data-x="prod-PotentialCustomElementName">PotentialCustomElementName</dfn> ::=</code></dt>
     <dd><code data-x="">[a-z] （<span data-x="prod-PCENChar">PCENChar</span>）* '-'
     （<span data-x="prod-PCENChar">PCENChar</span>）*</code></dd>

     <dt><code data-x=""><dfn data-x="prod-PCENChar">PCENChar</dfn> ::=</code></dt>
     <dd><code data-x="">"-" | "." | [0-9] | "_" | [a-z] | #xB7 | [#xC0-#xD6] | [#xD8-#xF6] |
     [#xF8-#x37D] | [#x37F-#x1FFF] | [#x200C-#x200D] | [#x203F-#x2040] | [#x2070-#x218F] |
     [#x2C00-#x2FEF] | [#x3001-#xD7FF] | [#xF900-#xFDCF] | [#xFDF0-#xFFFD] |
     [#x10000-#xEFFFF]</code></dd>
    </dl>

    <p>这使用了 <cite>XML</cite> 标准中的 <a href="https://www.w3.org/TR/xml/#sec-notation">EBNF 记法</a> 。 <ref spec=XML></p>
   </li>

   <li>
    <p><var>name</var> 不可是下列之一：</p>

    <ul class="brief">
     <li><code data-x="">annotation-xml</code></li>
     <li><code data-x="">color-profile</code></li>
     <li><code data-x="">font-face</code></li>
     <li><code data-x="">font-face-src</code></li>
     <li><code data-x="">font-face-uri</code></li>
     <li><code data-x="">font-face-format</code></li>
     <li><code data-x="">font-face-name</code></li>
     <li><code data-x="">missing-glyph</code></li>
    </ul>

    <p class="note">上述名字列表总结了所有包含横线的元素名，包括
    <cite>SVG 2</cite> 和 <cite>MathML</cite>
    <span data-x="other applicable specifications">相关标准</span>。
    <ref spec=SVG> <ref spec=MATHML></p>
   </li>
  </ul>

  <div class="note">
   <p>上述要求保证了 <span data-x="valid custom element name">合法 custom element 名</span> 的这些目标：</p>

   <ul>
    <li><p>以 <span data-x="ASCII lower alpha">ASCII 小写字母</span> 起始，确保 HTML 解析器将它们当做标签而不是文本。</li>

    <li><p>不包含任何 <span data-x="ASCII upper alpha">ASCII 大写字母</span>，
    确保用户代理总是可以将 HTML 元素当做大小写不敏感的 ASCII 来处理。</p></li>

    <li><p>包含一个横线，用于做命名空间来确保向后兼容（因为 HTML、SVG、MathML 中新增的元素 局部名 不会包含横线）。</p></li>

    <li><p>总是可以使用 <code
    data-x="dom-Document-createElement">createElement()</code> 和 <code
    data-x="dom-Document-createElementNS">createElementNS()</code> 来创建它们，
    这些 API 有着比解析器更高的限制。</p></li>
   </ul>

   <p>除这些限制之外，允许了大量的名字来给像
   <code data-x="">&lt;math-α></code> 或 <code data-x="">&lt;emotion-😍></code> 这样的用例最大的自由。</p>
  </div>

  <p><dfn data-x="custom element definition">Custom Element 定义</dfn> 描述了一个 <span>custom element</span> 的组成：</p>

  <dl>
   <dt><dfn data-x="concept-custom-element-definition-name" export
   for="custom element definition">name</dfn></dt>
   <dd>一个 <span data-x="valid custom element name">合法的 Custom Element 名称</span></dd>

   <dt><dfn data-x="concept-custom-element-definition-local-name" export
   for="custom element definition">局部名</dfn></dt>
   <dd>一个 局部名</dd>

   <dt><dfn data-x="concept-custom-element-definition-constructor" export
   for="custom element definition">constructor</dfn></dt>
   <dd>一个Web IDL <code data-x="idl-Function">Function</code> 回调函数类型的值，包装了
   <span data-x="custom element constructor">custom element 构造器</span></dd>

   <dt><dfn data-x="concept-custom-element-definition-observed-attributes">被观察的属性</dfn>列表</dt>
   <dd>一个 <code data-x="">sequence&lt;DOMString></code></dd>

   <dt><dfn data-x="concept-custom-element-definition-lifecycle-callbacks">生命周期回调</dfn>列表</dt>
   <dd>一个映射，其键是字符串 "<code data-x="">connectedCallback</code>"，
   "<code data-x="">disconnectedCallback</code>"，
   "<code data-x="">adoptedCallback</code>"，
   "<code data-x="">attributeChangedCallback</code>"，
   "<code data-x="">formAssociatedCallback</code>"，
   "<code data-x="">formDisabledCallback</code>",
   "<code data-x="">formResetCallback</code>" 和 "<code data-x="">formStateRestoreCallback</code>"。
   相应的值是 Web IDL <code data-x="idl-Function">Function</code> 回调函数类型的值，或者 null。默认每一项的值都是null。</dd>

   <dt>一个<dfn data-x="concept-custom-element-definition-construction-stack">construction
   stack</dfn></dt>
   <dd>一个初始为空的列表，由 <span data-x="concept-upgrade-an-element">元素升级</span> 算法和
   和 <a href="#html-element-constructors">HTML 元素构造器</a> 操作。列表中每一项都将是一个元素或者一个
   <dfn data-x="concept-already-constructed-marker"><i>已经构造的</i> 标记</dfn>。</dd>

   <dt><dfn data-x="concept-custom-element-definition-form-associated">表单相关</dfn> 布尔</dt>
   <dd>如果为真，用户代理会把和这个 <span data-x="custom element definition">custom element 定义</span> 关联的元素当作
   <span data-x="form-associated custom element">表单相关的 custom elements</span> 处理。</dd>

   <dt><dfn data-x="concept-custom-element-definition-disable-internals">disable 内部</dfn> 布尔</dt>
   <dd>控制 <code data-x="dom-attachInternals">attachInternals()</code>。

   <dt><dfn data-x="concept-custom-element-definition-disable-shadow" export
   for="custom element definition">禁用 shadow</dfn> 布尔</dt>
   <dd>控制 <code data-x="dom-Element-attachShadow">attachShadow()</code>。
  </dl>

  <p>给定一个 <var>document</var>，<var>namespace</var>，<var>localName</var>，以及 <var>is</var>，
  <dfn export data-x="look up a custom element definition">查找一个 custom element 的定义</dfn> 应执行下列步骤（
  返回一个 <span data-x="custom element definition">custom element 定义</span> 或 null）：</p>

  <ol>
   <li><p>如果 <var>namespace</var> 不是 <span data-x="html namespace">HTML 命名空间</span>，返回 null。</p></li>

   <li><p>如果 <var>document</var> 的 <span data-x="concept-document-bc">浏览环境</span> 是 null，返回 null。</p></li>

   <li><p>令 <var>registry</var> 为 <var>document</var> 的
   <span data-x="relevant global object">相关全局对象</span> 的
   <code>CustomElementRegistry</code> 对象。</p></li>

   <li><p>如果在 <var>registry</var> 中有一个 <span data-x="custom element definition">custom element 定义</span> 的
   <span data-x="concept-custom-element-definition-name">name</span> 和 <span
   data-x="concept-custom-element-definition-local-name">局部名</span> 都等于
   <var>localName</var>，返回该 <span data-x="custom element definition">custom element 定义</span>。</p></li>

   <li><p>如果在 <var>registry</var> 中有一个 <span data-x="custom element definition">custom element 定义</span> 的
   <span data-x="concept-custom-element-definition-name">name</span> 等于 <var>is</var> 且
   <span data-x="concept-custom-element-definition-local-name">局部名</span> 等于 <var>localName</var>，返回该
   <span data-x="custom element definition">custom element 定义</span>。</p></li>

   <li><p>返回 null。</p></li>
  </ol>

